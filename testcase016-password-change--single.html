<!DOCTYPE html><html lang="en"><head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>D16 - Password Change Test v 1.2</title>
        
<style>
html {
    box-sizing: border-box;
}

body, * {
    margin: 0;
    padding: 0;
}

body {
    background: #fefefe;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* App */

#app {
    display: grid;
    grid-template-columns: auto 1fr;
    /* justify-content: space-between; */
}

/* Main Forms */

.pc-form__container {
    position: relative;
    margin: 0 .5em;
    margin-top: 1.4em;
}

.pc-form__container > .label {
    position: absolute;
    left: .4em;
    top: -.8em;
    padding: 0 .2em .2em;
    font-weight: bold;
    color: rgb(0, 78, 0);
    border: 1px solid rgb(134, 114, 0);
    border-radius: .2em;
    background-color: #fffdda;
    cursor: default;
}

.pc-form {
    display: grid;
    padding: 1.4em .4em .4em;
    border: 1px dotted gray;
    background-color: hsla(209, 100%, 86%, 0.561);
}

.form-username {
    height: 1.6em;
    display: grid;
    padding-bottom: 1em;
}

.form-fields {
    display: grid;
}

input[type=text], input[type=password] {
    padding: .4em;
}

.pc__buttons {
    margin: .4em 0 0;
    display: grid;
    justify-content: right;
}

.pc__buttons button {
    padding: .4em;
}

.form-options {
    margin-top: .4em;
    padding-top: .2em;
    border-top: 1px solid hsla(210, 23%, 59%, 0.5);
}

.form-options label, .pm-test-data label {
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    font-size: .8em;
    user-select: none;
}

/* Data Forms */

.data-forms {
    position: relative;
    margin-top: 1.4em;
    background-color: hsl(120, 100%, 99%);
    border: 1px dotted gray;
    max-width: 22em;

    display: grid;
}

.data-form__label {
    cursor: default;
}

.data-form__label, .data-form__add, .data-form__2Valut {
    position: absolute;
    left: .4em;
    top: -.8em;
    padding: 0 .2em .2em;
    font-weight: bold;
    color: rgb(0, 78, 0);
    border: 1px solid rgb(134, 114, 0);
    border-radius: .2em;
    background-color: #fffdda;
}

.data-form__add {
    left: initial;
    top: -.6em;
    right: .4em;

    width: 1.4em;
    height: 1.2em;
    line-height: 1.2em;
    font-size: 1.3em;
    font-weight: bold;
    outline: 0;
    cursor: pointer;
}

.data-form__2Valut {
    left: initial;
    top: -.6em;
    right: 2em;

    width: 2em;
    height: 1.2em;
    line-height: 1.2em;
    font-size: 1.3em;
    font-weight: bold;
    outline: 0;
    cursor: pointer;
}

.data-form__label input {
    width: 1.1em;
    height: .7em;
    font-size: .3em;
    padding: 0;
    cursor: default;
}

.pm-test-data {
    margin: 1em .4em 0;
    display: grid;
}

/* Row */

.pm-test-data__row {
    display: grid;
    grid-template-columns: 1fr min-content min-content;
    margin-bottom: .2em;
}

.pm-test-data label {
    font-size: .8em;
    color: hsl(0, 0%, 70%);
    border: 1px dotted hsl(0, 0%, 70%);
    border-radius: 3px;
    padding: .2em;
    margin-left: .4em;

    user-select: none;
}

.pm-test-data__row input {
    min-width: 2em;
}

.data-form__del {
    width: 1.4em;
    line-height: 1.2em;
    font-size: 1.3em;
    font-weight: bold;
    text-align: center;
    cursor: pointer;

    margin-left: .2em;

    color: hsl(0, 0%, 70%);
    border: 1px dotted hsl(0, 0%, 70%);
    border-radius: 3px;

    user-select: none;
}

/* Vault */

.vault-container {
    padding: 0 .4em;
    user-select: none;
    align-self: end;
    padding-bottom: .4em;
}

.vault-container__row {
    display: grid;
    grid-template-columns: 1fr min-content min-content;
}

.vault-container__row input {
    background-color: transparent;
    border: 1px dotted hsl(0, 0%, 70%);
    border-radius: 3px;
}

/* Done */
</style>

    <link rel="shortcut icon" type="image/x-icon" href="data:image/png;base64,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAg7hBAIO4QQCDuEEAg7hBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIO4QQCDuEEAg7hBM4O4QTODuEEAg7hBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAg7hBAIO4QQuDuEGxg7hBsYO4QQuDuEEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIO4QQCDuEEAg7hBWoO4QfeDuEH3g7hBWoO4QQCDuEEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAg7hBAIO4QRqDuEHJg7hB/4O4Qf+DuEHJg7hBGoO4QQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIO4QQCDuEEAg7hBeoO4Qf6DuEH/g7hB/4O4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">
</head>
    <body>
        <script type="text/x-template" id="test-template">
            <div class="pc-form__container">
                <span class="label">{{formLabel}}</span>
                <form class="pc-form" :id="formId">
                    <div class="form-username"></div>
                    <div class="form-fields"></div>
                    <div class="pc__buttons">
                        <div>
                            <button @click.prevent="clearValues">Clear</button>
                            <button @click.prevent="fillValues">Fill-in</button>
                        </div>
                    </div>
                </form>
                <div class="form-options">
                    <label><input type="checkbox" v-model="opt_hasUsername"> Add username field</label>
                    <label><input type="checkbox" v-model="opt_hasLogin"> Form has corresponding login</label>
                    <label><input type="checkbox" v-model="opt_fillInvalid"> Fill-in with invalid credentials</label>
                </div>
            </div>
        </script>

        <script type="text/x-template" id="hidden-data-form">
            <div class="data-forms">
                <form id="pm-tm-pchange-data" class="data-form">
                    <div class="data-form__label">
                        <span>PM Test Data</span>
                        <input type="text" id="pm-tm-pchange-fake-name" value="for-dp" tabIndex="-1" />
                        <input type="password" id="pm-tm-pchange-fake-pass" value="for-dp2" tabIndex="-1" />
                    </div>
                    <button @click.prevent="onAddToVault" class="data-form__2Valut" tabIndex="-1" title="Store to Vault">V+</button>
                    <button @click.prevent="onAddField" class="data-form__add" tabIndex="-1" title="Add new data field">+</button>
                    <div class="pm-test-data">
                        <div class="pm-test-data__row" v-for="(field, index) of fields" :key="field.idx">
                            <input class="pm-tm-pchange-value" type="text" v-model="field.value" />
                            <label><input class="pm-tm-pchange-pass" type="checkbox" v-model="field.password" tabIndex="-1">Password</label>
                            <div class="data-form__del" @click="onDelField(field.idx)">-</div>
                        </div>
                    </div>
                </form>
                <div class="vault-container">
                    <form id="pm-tm-vault">
                        <div class="vault-container__row" v-for="item of vault" :key="item.idx">
                            <input type="text" :value="vaultItemDispText(item.data)" disabled title="Vault item">
                            <div class="data-form__del" @click="onDelFromVault(item.idx)" title="Remove from Vault">-</div>
                            <div class="data-form__del" @click="onSetFieldsFromVault(item.data)" title="Copy from Vault">&ShortUpArrow;</div>
                        </div>
                    </form>
                </div>
            </div>
        </script>
    
        <div id="app">
            <div class="main-forms">
                <test-form data-form-id="formA-nn"></test-form>
                <test-form data-form-id="formB-cn"></test-form>
                <test-form data-form-id="formC-cnn"></test-form>
            </div>

            <!-- <button v-on:click="eventParent">Clique me to emit from parent component</button>
            <br />
            <child v-on:event_child="eventChild"></child> -->

            <hidden-data-form></hidden-data-form>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        
<script>
Vue.component('child', {
    template: `
        <div>
            <button v-on:click="emit">Clique me to emit from child component</button>
        </div>
    `,
    methods: {
        emit: function() {
            this.$emit('event_child', 1);
        }
    }
});

const formsData = {
    'formA-nn': {
        label: 'Change: New+New',
        fields: [
            {
                type: 'password',
                placeholder: "Password New",
                name: 'password-new',
                autocomplete: 'new-password',
                'data-ftype': 1 // new
            },
            {
                type: 'password',
                placeholder: "Password Confirm",
                name: 'password-confirm',
                autocomplete: 'new-password',
                'data-ftype': 1 // new
            },
        ]
    },
    'formB-cn': {
        label: 'Change: Cur+New',
        fields: [
            {
                type: 'password',
                placeholder: "Password Current",
                name: 'password-current',
                autocomplete: 'current-password',
                'data-ftype': 0 // old
            },
            {
                type: 'password',
                placeholder: "Password New",
                name: 'password-new',
                autocomplete: 'new-password',
                'data-ftype': 1 // new
            },
        ]
    },
    'formC-cnn': {
        label: 'Change Cur+New+New',
        fields: [
            {
                type: 'password',
                placeholder: "Password Current",
                name: 'password-current', // <- always current
                autocomplete: 'current-password',
                'data-ftype': 0 // old
            },
            {
                type: 'password',
                placeholder: "Password New",
                name: 'password-new',
                autocomplete: 'new-password',
                'data-ftype': 1 // new
            },
            {
                type: 'password',
                placeholder: "Password Confirm",
                name: 'password-confirm',
                autocomplete: 'new-password',
                'data-ftype': 1 // new
            },
        ]
    },
};

function setAttrs(el, attrs) {
    Object.keys(attrs).forEach(_ => el.setAttribute(_, attrs[_]));
}

Vue.component('test-form', {
    template: '#test-template',
    data: function() {
        return {
            formId: '',
            formLabel: '',

            opt_hasUsername: false,
            opt_hasLogin: true,
            opt_fillInvalid: false,

            fillin: [] // fill-values: 0 - old; 1 - new
        };
    },
    mounted() {
        this.formId = this.$el.dataset['formId'];
        
        let form = formsData[this.formId];
        this.formLabel = form.label;
        form.fields.forEach(_ => this.addField(_));

        this.fillin = form.fields.map(_ => _['data-ftype']);
    },
    watch: {
        opt_hasUsername: function(value) {
            this.addFormUsername(value);
        }
    },
    methods: {
        addFormUsername(add) {
            let formEl = this.$el.querySelector('.form-username');
            let usernameEl = formEl.querySelector('.username');
            if (add) {
                if (!usernameEl) {
                    let el = document.createElement('input');
                    setAttrs(el, {
                        type: 'text',
                        'class': 'username',
                        placeholder: 'User name',
                        value: 'maxzz'

                    });
                    formEl.insertBefore(el, formEl.firstElementChild);
                }
            } else {
                if (usernameEl) {
                    formEl.removeChild(usernameEl);
                }
            }
        },
        addField(attrs) {
            let formEl = this.$el.querySelector('.form-fields');
            let all = [...formEl.querySelectorAll('input:not([type=checkbox])')];
            let last = all[all.length - 1] ? all[all.length - 1].nextElementSibling : formEl.firstElementChild;

            let el = document.createElement('input');
            setAttrs(el, attrs);
            formEl.insertBefore(el, last);
        },
        fillValues() {
            let all = [...this.$el.querySelectorAll('.form-fields input')];
            all.forEach((_, index) => _.value = `____ ${this.fillin[index]} ____`);
        },
        clearValues() {
            let all = [...this.$el.querySelectorAll('.form-fields input')];
            all.forEach(_ => _.value = '');
        },
    },
});

const STORAGE_CURRENT = 'd16-pchange-data';
const STORAGE_VAULT = 'd16-pchange-vault';

Vue.component('hidden-data-form', {
    template: '#hidden-data-form',
    data: () => {
        return {
            lastIndex: 10,
            loadingLocalStorage: false,
            fields: [],
            vault: [],
        };
    },
    created() {
        this.loadLocalStorage();
        this.loadVault();
    },
    methods: {
        /* Fields */
        parseFieldsFromString(cnt) {
            try {
                cnt = cnt && JSON.parse(cnt) || [];
            } catch(err) {
                cnt = [];
            }
            cnt.forEach(_ => _.idx = this.lastIndex++);
            return cnt;
        },
        loadLocalStorage() {
            this.loadingLocalStorage = true;
            let cnt = localStorage.getItem(STORAGE_CURRENT);
            this.fields = this.parseFieldsFromString(cnt);
        },
        saveFieldsToLocalStorage() {
            let cnt = JSON.stringify(this.fields);
            localStorage.setItem(STORAGE_CURRENT, cnt);
        },
        onAddField() {
            this.fields.push({
                value: `data ${this.lastIndex}`,
                password: false,
                idx: this.lastIndex++,
            });
        },
        onDelField(idx) {
            let newFields = this.fields.filter(_ => _.idx != idx);
            this.fields = newFields; 
        },
        /* Vault */
        loadVault() {
            let vault = localStorage.getItem(STORAGE_VAULT);
            vault = JSON.parse(vault || []);
            vault.forEach(_ => _.idx = this.lastIndex++);
            this.vault = vault;
        },
        vaultItemDispText(vaultItem) {
            let cnt = JSON.parse(vaultItem || '[]');
            return cnt.reduce((acc, _) => acc += `${_.value}${_.password?'***':''} `, '');
        },
        onAddToVault() {
            this.vault = [{
                data: JSON.stringify(this.fields),
                idx: this.lastIndex++,
            }, ...this.vault];
            localStorage.setItem(STORAGE_VAULT, JSON.stringify(this.vault));
        },
        onDelFromVault(idx) {
            this.vault = this.vault.filter(_ => _.idx !== idx);
        },
        onSetFieldsFromVault(data) {
            this.fields = this.parseFieldsFromString(data);
        },
    },
    watch: {
        fields: {
            handler(val, old) {
                if (this.loadingLocalStorage) {
                    this.loadingLocalStorage = false;
                } else {
                    this.saveFieldsToLocalStorage();
                }
            },
            deep: true
        }
    }
});

var vm = new Vue({
    el: '#app',
    created() {
        this.$on('event_parent', function(id) {
            console.log('Event from parent component emitted', id);
        });
    },
    data: function() {
        return {
            msg: 'hello vue',
            id: ''
        };
    },
    methods: {
        eventChild: function(id) {
            console.log('Event from child component emitted', id);
        },
        eventParent: function() {
            this.$emit('event_parent', 1);
        }
    }
});

</script>

    

</body></html>